{"version":3,"sources":["webpack://@luxms/bi-resources/webpack/universalModuleDefinition","webpack://@luxms/bi-resources/external \"bi-internal/services\"","webpack://@luxms/bi-resources/external \"react\"","webpack://@luxms/bi-resources/webpack/bootstrap","webpack://@luxms/bi-resources/webpack/runtime/compat get default export","webpack://@luxms/bi-resources/webpack/runtime/define property getters","webpack://@luxms/bi-resources/webpack/runtime/hasOwnProperty shorthand","webpack://@luxms/bi-resources/./src/ds_3/TreeView.tsx"],"names":["ROOT_KOOB_ID","FAFORM_KOOB_ID","mapItems","dtos","organisationsMap","Map","forEach","dto","organisationData","has","predpr_pred_id","get","id","name","pname","hasChildren","children_count","formData","form_id","undefined","form_status","set","Array","from","values","mapColumns","map","frm_id","title","createRootKoobDataService","filters","KoobDataService","type","sql","createFaformKoobDataService","Th","children","borderRight","padding","Td","minWidth","ShowChildrenButton","isOpened","onClick","handleClick","useCallback","border","cursor","width","height","display","textAlign","useItems","dataService","useMemo","useState","items","setItems","handleSataServiceUpdate","model","error","loading","itemDtos","useEffect","subscribeUpdatesAndNotify","useFaformColumns","ItemChildrenView","item","depth","formColumns","ItemView","setIsOpened","repeat","column","TreeView","props","overflow","maxHeight"],"mappings":"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","file":"ds_3/TreeView.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"react\"), require(\"bi-internal/services\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"react\", \"bi-internal/services\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@luxms/bi-resources\"] = factory(require(\"react\"), require(\"bi-internal/services\"));\n\telse\n\t\troot[\"@luxms/bi-resources\"] = factory(root[\"react\"], root[\"bi-internal/services\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__297__, __WEBPACK_EXTERNAL_MODULE__2__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = __WEBPACK_EXTERNAL_MODULE__297__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import React, {useEffect, useMemo, PropsWithChildren, useCallback, useState} from \"react\";\r\n\r\nimport {KoobDataService} from \"bi-internal/services\";\r\nimport {IKoobDataModel} from \"bi-internal/services/koob\";\r\n\r\n/**\r\n * ID куба данные которого мы отоборжаем.\r\n */\r\nconst ROOT_KOOB_ID = \"luxmsbi.organisations_test\";\r\n/**\r\n * ID куба с перечнем дополнительных колонок.\r\n */\r\nconst FAFORM_KOOB_ID = \"luxmsbi.public_faform\";\r\n\r\n/**\r\n * Интерфейс сущности, которую мы получаем из БД, и описывающей дополнительную колонку.\r\n */\r\ninterface FaformDto {\r\n    frm_id: number;\r\n    title: string;\r\n}\r\n\r\n/**\r\n * Интерфейс сущности, которую мы получаем из БД, и описывающей организацию.\r\n */\r\ninterface OrganisationDataDto {\r\n    predpr_pred_id: number;\r\n    pname?: string;\r\n    gr_id?: number;\r\n    sname?: string;\r\n    vname?: string;\r\n    pred_v_id?: number;\r\n    pred_n_id?: number;\r\n    form_status?: string;\r\n    form_title?: string;\r\n    form_id?: number;\r\n    children_count: number; \r\n}\r\n\r\n/**\r\n * Интерфейс сущности, которую мы используем в наших UI комонентах, и описывающей дополнительную колонку.\r\n */\r\ninterface FaformColumn {\r\n    id: number;\r\n    title: string;\r\n}\r\n\r\n/**\r\n * Интерфейс сущности, которую мы используем в наших UI комонентах, и описывающей организацию.\r\n */\r\ninterface OrganisationData {\r\n    id: number;\r\n    name: string;\r\n    hasChildren: boolean;\r\n    formData: Map<number, string>;\r\n}\r\n\r\n/**\r\n * Преобразование сущностей организаций получаемых из бд к внутреннему формату.\r\n */\r\nconst mapItems = (dtos: OrganisationDataDto[]): OrganisationData[] => {\r\n    const organisationsMap = new Map<OrganisationData[\"id\"], OrganisationData>();\r\n    dtos.forEach((dto) => {\r\n        const organisationData: OrganisationData = organisationsMap.has(dto.predpr_pred_id) \r\n            ? \r\n                organisationsMap.get(dto.predpr_pred_id)!\r\n            :\r\n                {\r\n                    id: dto.predpr_pred_id,\r\n                    name: dto.pname || \"\",\r\n                    hasChildren: dto.children_count > 0,\r\n                    formData: new Map<number, string>(),\r\n                };\r\n\r\n        if (dto.form_id !== undefined && dto.form_id !== null && dto.form_status) {\r\n            organisationData.formData.set(dto.form_id, dto.form_status);\r\n        }\r\n        organisationsMap.set(organisationData.id, organisationData);\r\n    });\r\n\r\n    return Array.from(organisationsMap.values());\r\n};\r\n\r\n/**\r\n * Преобразование сущностей доп. колонок получаемых из бд к внутреннему формату.\r\n */\r\nconst mapColumns = (dtos: FaformDto[]): FaformColumn[] => dtos.map((dto) => ({id: dto.frm_id, title: dto.title}));\r\n\r\n/**\r\n * Создаем KoobDataService для загрузки орагнизаций.\r\n */\r\nconst createRootKoobDataService = (filters: any = {}) => {\r\n    return new KoobDataService(\r\n        ROOT_KOOB_ID,\r\n        [\r\n            {id: \"predpr_pred_id\", type: \"INTEGER\", sql: \"predpr_pred_id\", title: \"predpr_pred_id\"},\r\n            {id: \"gr_id\", type: \"INTEGER\", sql: \"gr_id\", title: \"gr_id\"},\r\n            {id: \"pred_v_id\", type: \"INTEGER\", sql: \"pred_v_id\", title: \"pred_v_id\"},\r\n            {id: \"pred_n_id\", type: \"INTEGER\", sql: \"pred_n_id\", title: \"pred_n_id\"},\r\n            {id: \"pname\", type: \"STRING\", sql: \"pname\", title: \"pname\"},\r\n            {id: \"sname\", type: \"STRING\", sql: \"sname\", title: \"sname\"},\r\n            {id: \"vname\", type: \"STRING\", sql: \"vname\", title: \"vname\"},\r\n            {id: \"form_status\", type: \"STRING\", sql: \"form_status\", title: \"form_status\"},\r\n            {id: \"form_title\", type: \"STRING\", sql: \"form_title\", title: \"form_title\"},\r\n            {id: \"children_count\", type: \"INTEGER\", sql: \"children_count\", title: \"children_count\"},\r\n        ],\r\n        [],\r\n        filters,\r\n    );\r\n};\r\n\r\n/**\r\n * Создаем KoobDataService для загрузки доп. колонок.\r\n */\r\nconst createFaformKoobDataService = () => {\r\n    return new KoobDataService(\r\n        FAFORM_KOOB_ID,\r\n        [\r\n            {id: \"frm_id\", type: \"INTEGER\", sql: \"predpr_pred_id\", title: \"predpr_pred_id\"},\r\n            {id: \"title\", type: \"STRING\", sql: \"title\", title: \"title\"},\r\n        ],\r\n        [],\r\n        {},\r\n    );\r\n};\r\n\r\n/**\r\n * Стилизиванный тег th\r\n */\r\nconst Th = ({children}: PropsWithChildren<{}>) => <th style={{borderRight: \"1px solid darkgray\", padding: \"5px\"}}>{children}</th>;\r\n\r\n/**\r\n * Стилизиванный тег td\r\n */\r\nconst Td = ({children}: PropsWithChildren<{}>) => <td style={{minWidth: \"200px\", borderRight: \"1px solid darkgray\", padding: \"5px\"}}>{children}</td>;\r\n\r\ninterface ShowChildrenButtonProps {\r\n    isOpened: boolean;\r\n    \r\n    onClick: (isOpened: boolean) => void;\r\n}\r\n/**\r\n * Кнопка свернуть/развернуть дочерние организации.\r\n */\r\nconst ShowChildrenButton = ({isOpened, onClick}: ShowChildrenButtonProps) => {\r\n    const handleClick = useCallback(() => {\r\n        onClick(!isOpened);\r\n    }, [isOpened, onClick]);\r\n    return (\r\n        <span\r\n            onClick={handleClick}\r\n            style={{border: \"1px solid black\", cursor: \"pointer\", width: \"23px\", height: \"23px\", display: \"inline-block\", textAlign: \"center\"}}\r\n        >\r\n            {isOpened ? \"-\" : \"+\"}\r\n        </span>\r\n    );\r\n};\r\n\r\n/**\r\n * Хук загрузки орагнизаций.\r\n */\r\nconst useItems = (filters: any = {}) => {\r\n    const dataService = useMemo(() => createRootKoobDataService(filters), []);\r\n    const [items, setItems] = useState<OrganisationData[]>([]);\r\n\r\n    const handleSataServiceUpdate = useCallback((model: IKoobDataModel) => {\r\n        if (model.error || model.loading) {\r\n            setItems([]);\r\n            return;\r\n        }\r\n\r\n        const itemDtos = model.values as OrganisationDataDto[];\r\n        setItems(mapItems(itemDtos));\r\n    }, [setItems]);\r\n    \r\n    useEffect(() => {\r\n        dataService.subscribeUpdatesAndNotify(handleSataServiceUpdate);\r\n        return () => {\r\n            dataService.subscribeUpdatesAndNotify(handleSataServiceUpdate);\r\n        };\r\n\r\n    }, [dataService, handleSataServiceUpdate]);\r\n\r\n    return items;\r\n}\r\n\r\n/**\r\n * Хук загрузки доп. колонок.\r\n */\r\nconst useFaformColumns = () => {\r\n    const dataService = useMemo(createFaformKoobDataService, []);\r\n    const [items, setItems] = useState<FaformColumn[]>([]);\r\n\r\n    const handleSataServiceUpdate = useCallback((model: IKoobDataModel) => {\r\n        if (model.error || model.loading) {\r\n            setItems([]);\r\n            return;\r\n        }\r\n\r\n        const itemDtos = model.values as FaformDto[];\r\n        setItems(mapColumns(itemDtos));\r\n    }, [setItems]);\r\n    \r\n    useEffect(() => {\r\n        dataService.subscribeUpdatesAndNotify(handleSataServiceUpdate);\r\n        return () => {\r\n            dataService.subscribeUpdatesAndNotify(handleSataServiceUpdate);\r\n        };\r\n\r\n    }, [dataService, handleSataServiceUpdate]);\r\n\r\n    return items;\r\n};\r\n\r\ninterface ItemChildredViewProps {\r\n    item: OrganisationData;\r\n    depth: number;\r\n    formColumns: FaformColumn[];\r\n}\r\n\r\n/**\r\n * Компонента отображающая дочерние организации.\r\n */\r\nconst ItemChildrenView = ({item, depth, formColumns}: ItemChildredViewProps) => {\r\n    const items = useItems({\"PRED_V_ID\": [\"=\", item.id]});\r\n\r\n    return (\r\n        <>{items.map((item) => <ItemView key={item.id} item={item} depth={depth + 1} formColumns={formColumns}/>)}</>\r\n    );\r\n}\r\n\r\ninterface ItemViewProps {\r\n    item: OrganisationData;\r\n    depth: number;\r\n    formColumns: FaformColumn[];\r\n}\r\n\r\n/**\r\n * Компонента отображающая организацию.\r\n */\r\nconst ItemView = ({item, depth, formColumns}: ItemViewProps) => {\r\n    const [isOpened, setIsOpened] = useState(false);\r\n    return (\r\n        <>\r\n            <tr>\r\n                <Td>\r\n                    {\"----\".repeat(depth)}{item.hasChildren && <ShowChildrenButton isOpened={isOpened} onClick={setIsOpened}/>}{item.id}</Td>\r\n                <Td>{item.name}</Td>\r\n                {formColumns.map((column) => <Td key={column.id}>{item.formData.get(column.id) || \"No data\"}</Td>)}\r\n            </tr>\r\n            {isOpened && <ItemChildrenView item={item} depth={depth} formColumns={formColumns} />}\r\n        </>\r\n        \r\n    );\r\n};\r\n\r\n/**\r\n * Дерево организаций.\r\n */\r\nconst TreeView = (props) => {\r\n    const items = useItems({\"GR_ID\": [\"=\", 7]});\r\n    const formColumns = useFaformColumns();\r\n\r\n    return (\r\n        <div style={{padding: \"20px\", overflow: \"scroll\", maxHeight: \"400px\"}}>\r\n           <table>\r\n                <thead>\r\n                    <Th>ID</Th>\r\n                    <Th>Наименование</Th>\r\n                    {formColumns.map((column) => <Td key={column.id}>{column.title}</Td>)}\r\n                </thead>\r\n                <tbody>\r\n                    {items.map((item) => <ItemView key={item.id} item={item} depth={0} formColumns={formColumns}/>)}\r\n                </tbody>\r\n           </table>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default TreeView;\r\n"],"sourceRoot":""}